# ğŸ¦ MacauBank - é‡‘èçº§å¾®æœåŠ¡æ¶æ„ç¤ºä¾‹é¡¹ç›®

<div align="center">

**åŸºäº DDD çš„åˆ†å¸ƒå¼é“¶è¡Œæ ¸å¿ƒç³»ç»Ÿ**

[![JDK](https://img.shields.io/badge/JDK-17-orange.svg)](https://www.oracle.com/java/technologies/javase/jdk17-archive-downloads.html)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2.4-brightgreen.svg)](https://spring.io/projects/spring-boot)
[![Dubbo](https://img.shields.io/badge/Dubbo-3.3.0-blue.svg)](https://dubbo.apache.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

MacauBank æ˜¯ä¸€ä¸ªåŸºäº **é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰** çš„é‡‘èçº§å¾®æœåŠ¡æ¶æ„ç¤ºä¾‹é¡¹ç›®ï¼Œå®ç°äº†é“¶è¡Œæ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿçš„å…³é”®åŠŸèƒ½ï¼ŒåŒ…æ‹¬è´¦æˆ·ç®¡ç†ã€è½¬è´¦äº¤æ˜“ã€å¤–æ±‡å…‘æ¢ç­‰ã€‚

é¡¹ç›®é‡‡ç”¨ä¸»æµçš„å¾®æœåŠ¡æŠ€æœ¯æ ˆï¼Œä¸¥æ ¼éµå¾ª DDD åˆ†å±‚æ¶æ„ï¼Œå®ç°äº†åˆ†å¸ƒå¼äº‹åŠ¡ã€çŠ¶æ€æœºé©±åŠ¨ã€å¤å¼è®°è´¦ç­‰é‡‘èçº§ç‰¹æ€§ï¼Œå¯ä½œä¸ºå­¦ä¹ å¾®æœåŠ¡æ¶æ„å’Œé‡‘èä¸šåŠ¡çš„å‚è€ƒé¡¹ç›®ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- âœ… **DDD å››å±‚æ¶æ„**ï¼šä¸¥æ ¼çš„ Interfacesã€Applicationã€Domainã€Infrastructure åˆ†å±‚ï¼ŒRepository æ¥å£éš”ç¦»
- âœ… **çŠ¶æ€æœºé©±åŠ¨**ï¼šåŸºäºè´£ä»»é“¾æ¨¡å¼çš„ä¸šåŠ¡æµç¨‹ç¼–æ’ï¼ˆ10 ä¸ª Handlerï¼‰
- âœ… **ç­–ç•¥æ¨¡å¼**ï¼š3 ç§è½¬è´¦ç­–ç•¥ï¼ˆè¡Œå†…/è·¨è¡Œ/è·¨å¢ƒï¼‰ï¼Œç¬¦åˆå¼€é—­åŸåˆ™
- âœ… **åˆ†å¸ƒå¼äº‹åŠ¡**ï¼šä» Seata AT æ¼”è¿›åˆ° TCC + çŠ¶æ€æœºçš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ
- âœ… **å†²æ­£/é€€æ¬¾**ï¼šå®Œæ•´çš„é€†å‘äº¤æ˜“æµç¨‹ï¼Œå¤ç”¨çŠ¶æ€æœºæ¶æ„
- âœ… **å®¡è®¡æ—¥å¿—**ï¼šAOP + SpEL è¡¨è¾¾å¼ï¼Œå¼‚æ­¥å­˜å‚¨ï¼Œæ»¡è¶³ç›‘ç®¡åˆè§„
- âœ… **Sentinel é™æµç†”æ–­**ï¼šæ ¸å¿ƒæ¥å£é…ç½®ç†”æ–­é™çº§ç­–ç•¥
- âœ… **å¤å¼è®°è´¦**ï¼šç¬¦åˆé‡‘èè¡Œä¸šè§„èŒƒçš„ä¼šè®¡åˆ†å½•è®¾è®¡
- âœ… **ä¸‰å±‚å¹‚ç­‰æ€§é˜²å¾¡**ï¼šRedis Token + æ•°æ®åº“å”¯ä¸€ç´¢å¼• + ä¸šåŠ¡å¹‚ç­‰
- âœ… **èµ„æŸå‘Šè­¦**ï¼šå¹‚ç­‰æ ¡éªŒå‘ç°é‡‘é¢ä¸ä¸€è‡´æ—¶è§¦å‘å‘Šè­¦
- âœ… **HMAC é˜²ç¯¡æ”¹**ï¼šä½™é¢æ•°æ®å®Œæ•´æ€§æ ¡éªŒ
- âœ… **é«˜å¹¶å‘å¤„ç†**ï¼šä¹è§‚é” + åˆ†å¸ƒå¼é”çš„ç»„åˆæ–¹æ¡ˆ
- âœ… **Docker Compose éƒ¨ç½²**ï¼šä¸€é”®å¯åŠ¨å®Œæ•´çš„å¾®æœåŠ¡ç¯å¢ƒ

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| **æ ¸å¿ƒæ¡†æ¶** | Spring Boot | 3.2.4 | å¾®æœåŠ¡åŸºç¡€æ¡†æ¶ |
| **RPC æ¡†æ¶** | Apache Dubbo | 3.3.0 | æœåŠ¡é—´é€šä¿¡ |
| **ORM æ¡†æ¶** | MyBatis-Plus | 3.5.5 | æ•°æ®æŒä¹…åŒ– |
| **æ•°æ®åº“** | MySQL | 8.0.33 | å…³ç³»å‹æ•°æ®åº“ |
| **ç¼“å­˜** | Redis | 7.2 | åˆ†å¸ƒå¼ç¼“å­˜ |
| **æ¶ˆæ¯é˜Ÿåˆ—** | RocketMQ | 5.3.0 | å¼‚æ­¥æ¶ˆæ¯ |
| **æ³¨å†Œä¸­å¿ƒ** | Nacos | 2.5.2 | æœåŠ¡æ³¨å†Œä¸é…ç½®ä¸­å¿ƒ |
| **åˆ†å¸ƒå¼äº‹åŠ¡** | Seata | 2.5.0 | åˆ†å¸ƒå¼äº‹åŠ¡ç®¡ç† |
| **é“¾è·¯è¿½è¸ª** | SkyWalking | 9.4.0 | APM ç›‘æ§ |
| **é™æµç†”æ–­** | Sentinel | 1.8.6 | æµé‡æ§åˆ¶ |
| **åˆ†å¸ƒå¼é”** | Redisson | 3.27.2 | åˆ†å¸ƒå¼é”å®ç° |
| **å®¹å™¨åŒ–** | Docker Compose | - | å®¹å™¨ç¼–æ’ |

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Gateway Layer                        â”‚
â”‚                    (API Gateway)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Auth Service   â”‚  â”‚Transfer Serviceâ”‚  â”‚ Forex Service  â”‚
â”‚ (è®¤è¯æˆæƒ)      â”‚  â”‚  (è½¬è´¦å¼•æ“)     â”‚  â”‚  (å¤–æ±‡äº¤æ˜“)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Account Service â”‚
                    â”‚   (è´¦æˆ·æ ¸å¿ƒ)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     MySQL      â”‚  â”‚    Redis     â”‚  â”‚   RocketMQ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DDD åˆ†å±‚æ¶æ„

```
bank-backend/
â”œâ”€â”€ account-service/          # è´¦æˆ·æ ¸å¿ƒæœåŠ¡
â”‚   â”œâ”€â”€ interfaces/           # æ¥å£å±‚ï¼ˆHTTPã€RPCï¼‰
â”‚   â”œâ”€â”€ application/          # åº”ç”¨å±‚ï¼ˆæµç¨‹ç¼–æ’ï¼‰
â”‚   â”œâ”€â”€ domain/              # é¢†åŸŸå±‚ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰
â”‚   â””â”€â”€ infrastructure/      # åŸºç¡€è®¾æ–½å±‚ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰
â”œâ”€â”€ transfer-service/        # è½¬è´¦å¼•æ“æœåŠ¡
â”‚   â”œâ”€â”€ interfaces/
â”‚   â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”œâ”€â”€ pipeline/       # çŠ¶æ€æœº Handler é“¾
â”‚   â”‚   â””â”€â”€ service/        # é¢†åŸŸæœåŠ¡
â”‚   â””â”€â”€ infrastructure/
â”œâ”€â”€ forex-service/           # å¤–æ±‡äº¤æ˜“æœåŠ¡
â”œâ”€â”€ auth-service/            # è®¤è¯æˆæƒæœåŠ¡
â”œâ”€â”€ user-service/            # ç”¨æˆ·ç®¡ç†æœåŠ¡
â””â”€â”€ message-service/         # æ¶ˆæ¯é€šçŸ¥æœåŠ¡
```

---

## ğŸ’ æ ¸å¿ƒè®¾è®¡

### 1. çŠ¶æ€æœºé©±åŠ¨çš„è½¬è´¦æµç¨‹

é‡‡ç”¨è´£ä»»é“¾æ¨¡å¼å®ç°çŠ¶æ€æœºï¼Œæ¯ä¸ª Handler è´Ÿè´£ä¸€ä¸ªä¸šåŠ¡é˜¶æ®µï¼š

```
è½¬è´¦æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å†»ç»“èµ„é‡‘     â”‚ -> â”‚ å‘é€é£æ§MQ   â”‚ -> â”‚ æ‰£æ¬¾        â”‚
â”‚FreezeFund   â”‚    â”‚SendRiskMq   â”‚    â”‚DeductMoney  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                      â”‚
       v                                      v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§£å†»        â”‚ <- â”‚ å…¥è´¦        â”‚ <- â”‚ é€šçŸ¥SWIFT   â”‚
â”‚Unfreeze     â”‚    â”‚CreditPayee  â”‚    â”‚NotifySwift  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜åŠ¿**ï¼š
- èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤
- å¯æ‰©å±•ï¼Œæ–°å¢è½¬è´¦ç±»å‹åªéœ€é…ç½® Handler é“¾
- ç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆOCPï¼‰

### 1.1 å†²æ­£/é€€æ¬¾æµç¨‹ï¼ˆé€†å‘äº¤æ˜“ï¼‰

å¤ç”¨çŠ¶æ€æœºæ¶æ„å®ç°å®Œæ•´çš„é€†å‘æµç¨‹ï¼š

```
å†²æ­£æµç¨‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åå‘å…¥è´¦     â”‚ -> â”‚ åå‘æ‰£æ¬¾     â”‚ -> â”‚ åå‘æ‰‹ç»­è´¹   â”‚
â”‚ReverseCreditâ”‚    â”‚ReverseDeductâ”‚    â”‚ReverseFee   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŠ¶æ€æœºé©±åŠ¨ï¼š
SUCCESS/FAILED â†’ REVERSING â†’ REVERSED
```

**è®¾è®¡äº®ç‚¹**ï¼š
- ç­–ç•¥æ¨¡å¼ï¼š`getReversalTransition()` ç”±å„ç­–ç•¥è‡ªå®šä¹‰é€†å‘è·¯å¾„
- æ¶æ„å¯¹ç§°ï¼šæ­£å‘/é€†å‘ä½¿ç”¨åŒä¸€å¥—çŠ¶æ€æœºå¼•æ“
- å¹‚ç­‰ä¿æŠ¤ï¼šå†²æ­£è¯·æ±‚åŒæ ·æœ‰å¹‚ç­‰æ ¡éªŒ

### 2. åˆ†å¸ƒå¼äº‹åŠ¡æ¼”è¿›

**Seata ATï¼ˆCP æ¨¡å¼ï¼‰â†’ TCC + çŠ¶æ€æœºï¼ˆAP æ¨¡å¼ï¼‰**

| æ–¹æ¡ˆ | ä¸€è‡´æ€§ | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|------|--------|------|---------|
| Seata AT | å¼ºä¸€è‡´æ€§ | TPS ~10 | çŸ­é“¾è·¯ã€ä½å¹¶å‘ |
| TCC + çŠ¶æ€æœº | æœ€ç»ˆä¸€è‡´æ€§ | TPS ~1000+ | é•¿é“¾è·¯ã€é«˜å¹¶å‘ |

**æ¼”è¿›æ”¶ç›Š**ï¼š
- TPS ä» 10 æå‡åˆ° 1000+ï¼ˆ100 å€ï¼‰
- æ•°æ®åº“é”æŒæœ‰æ—¶é—´ï¼š3s â†’ 20ms
- é€šè¿‡ MQ é‡è¯• + å¹‚ç­‰æ€§ä¿è¯æœ€ç»ˆä¸€è‡´æ€§

### 3. å¤å¼è®°è´¦

ç¬¦åˆé‡‘èè¡Œä¸šè§„èŒƒçš„ä¼šè®¡åˆ†å½•è®¾è®¡ï¼š

```sql
-- è½¬è´¦ 1000 MOPï¼šA â†’ B
-- è´¦æˆ· Aï¼šå€Ÿæ–¹ï¼ˆDï¼‰1000
INSERT INTO account_sub_ledger (account_no, cd_flag, amount, balance, voucher_no)
VALUES ('A', 'D', 1000, 9000, 'V20260102001');

-- è´¦æˆ· Bï¼šè´·æ–¹ï¼ˆCï¼‰1000
INSERT INTO account_sub_ledger (account_no, cd_flag, amount, balance, voucher_no)
VALUES ('B', 'C', 1000, 11000, 'V20260102001');

-- æ£€æŸ¥ï¼šSUM(å€Ÿæ–¹) = SUM(è´·æ–¹) âœ“
```

**ä¸šåŠ¡ä»·å€¼**ï¼š
- è‡ªåŠ¨å¹³è¡¡æ£€æŸ¥ï¼ˆå€Ÿè´·ä¸å¹³ = æœ‰ Bugï¼‰
- å®¡è®¡è¿½æº¯ï¼ˆå®Œæ•´çš„ä¼šè®¡åˆ†å½•ï¼‰
- å¯¹è´¦ç®€åŒ–ï¼ˆæ—¥ç»ˆæ£€æŸ¥å€Ÿè´·å¹³è¡¡ï¼‰

### 4. ä¸‰å±‚å¹‚ç­‰æ€§é˜²å¾¡

```
è¯·æ±‚
  â”‚
  â”œâ”€> ã€ç¬¬ä¸€å±‚ã€‘Redis Tokenï¼ˆsetIfAbsentï¼‰
  â”‚   - TTL: 5ç§’
  â”‚   - æ‹¦æˆª 99% é‡å¤è¯·æ±‚
  â”‚
  â”œâ”€> ã€ç¬¬äºŒå±‚ã€‘ä¸šåŠ¡é€»è¾‘
  â”‚   - çŠ¶æ€æœºæ‰§è¡Œ
  â”‚   - æ•°æ®åº“æ“ä½œ
  â”‚
  â””â”€> ã€ç¬¬ä¸‰å±‚ã€‘æ•°æ®åº“å”¯ä¸€ç´¢å¼•
      - idempotent_key UNIQUE
      - æœ€åçš„ä¿åº•é˜²çº¿
```

**è®¾è®¡ç†å¿µ**ï¼š
- Redisï¼šå»‰ä»·çš„å¿«é€Ÿå¤±è´¥ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- æ•°æ®åº“ï¼šæ˜‚è´µçš„æœ€åä¿åº•ï¼ˆæ•°æ®ä¸€è‡´æ€§ï¼‰

### 5. HMAC é˜²ç¯¡æ”¹

```java
// ä½™é¢å˜åŠ¨æ—¶è®¡ç®— MAC ç 
String macCode = HmacUtils.hmacSha256Hex(
    SECRET_KEY, 
    balance + "|" + version + "|" + accountNo
);

// è¯»å–æ—¶æ ¡éªŒ MAC ç 
if (!macCode.equals(storedMacCode)) {
    throw new SecurityException("ä½™é¢æ•°æ®è¢«ç¯¡æ”¹");
}
```

**å®‰å…¨ä»·å€¼**ï¼š
- é˜²æ­¢ DBA æˆ–é»‘å®¢ç¯¡æ”¹ä½™é¢æ•°æ®
- é‡‘èçº§çš„æ•°æ®å®Œæ•´æ€§ä¿æŠ¤

### 6. é«˜å¹¶å‘å¤„ç†

**ä¹è§‚é” + åˆ†å¸ƒå¼é”**

```sql
-- ä¹è§‚é”ï¼ˆå¸¸è§„åœºæ™¯ï¼‰
UPDATE account_balance
SET balance = balance - #{amount},
    version = version + 1
WHERE account_no = #{accountNo}
  AND version = #{oldVersion}
  AND available_balance >= #{amount};
```

```java
// åˆ†å¸ƒå¼é”ï¼ˆçƒ­ç‚¹è´¦æˆ·ï¼‰
RLock lock = redissonClient.getLock(lockKey);
try {
    lock.tryLock(3, 10, TimeUnit.SECONDS);
    // ä¸šåŠ¡é€»è¾‘
} finally {
    lock.unlock();
}
```

**ç»„åˆä½¿ç”¨**ï¼š
- å¸¸è§„åœºæ™¯ï¼šä¹è§‚é”ï¼ˆæ€§èƒ½å¥½ï¼‰
- çƒ­ç‚¹è´¦æˆ·ï¼šåˆ†å¸ƒå¼é”ï¼ˆä¿è¯å®‰å…¨ï¼‰

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### ç¯å¢ƒè¦æ±‚

- JDK 17+
- Maven 3.8+
- Docker & Docker Compose
- è‡³å°‘ 4GB å¯ç”¨å†…å­˜

### ä¸€é”®å¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/MacauBank.git
cd MacauBank/bank-backend

# 2. å¯åŠ¨ä¸­é—´ä»¶ï¼ˆMySQLã€Redisã€RocketMQã€Nacosã€Seata ç­‰ï¼‰
cd docker
docker-compose up -d

# 3. ç­‰å¾…ä¸­é—´ä»¶å¯åŠ¨å®Œæˆï¼ˆçº¦ 2 åˆ†é’Ÿï¼‰
docker-compose ps

# 4. ç¼–è¯‘é¡¹ç›®
cd ..
mvn clean package -DskipTests

# 5. å¯åŠ¨å¾®æœåŠ¡
# æŒ‰é¡ºåºå¯åŠ¨ï¼šaccount-service -> transfer-service -> forex-service
cd account-service
mvn spring-boot:run

# æ–°å¼€ç»ˆç«¯
cd transfer-service
mvn spring-boot:run

# æ–°å¼€ç»ˆç«¯
cd forex-service
mvn spring-boot:run
```

### éªŒè¯æœåŠ¡

```bash
# æ£€æŸ¥ Nacos æœåŠ¡æ³¨å†Œ
open http://localhost:8848/nacos
# ç”¨æˆ·å/å¯†ç ï¼šnacos/nacos

# æ£€æŸ¥ SkyWalking ç›‘æ§
open http://localhost:8080

# æµ‹è¯•è½¬è´¦æ¥å£
curl -X POST http://localhost:8082/transfer/submit \
  -H "Content-Type: application/json" \
  -d '{
    "payerAccountNo": "ACC001",
    "payeeAccountNo": "ACC002",
    "amount": 1000,
    "currency": "MOP",
    "requestId": "REQ20260102001"
  }'
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### account_balanceï¼ˆä½™é¢è¡¨ï¼‰

```sql
CREATE TABLE account_balance (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    account_no VARCHAR(32) NOT NULL UNIQUE COMMENT 'è´¦å·',
    balance DECIMAL(18,2) NOT NULL COMMENT 'ä½™é¢',
    available_balance DECIMAL(18,2) NOT NULL COMMENT 'å¯ç”¨ä½™é¢',
    frozen_balance DECIMAL(18,2) NOT NULL DEFAULT 0 COMMENT 'å†»ç»“ä½™é¢',
    currency VARCHAR(3) NOT NULL DEFAULT 'MOP' COMMENT 'å¸ç§',
    version INT NOT NULL DEFAULT 0 COMMENT 'ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰',
    mac_code VARCHAR(64) COMMENT 'HMACæ ¡éªŒç ',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT='è´¦æˆ·ä½™é¢è¡¨';
```

#### account_sub_ledgerï¼ˆåˆ†æˆ·è´¦è¡¨ï¼‰

```sql
CREATE TABLE account_sub_ledger (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    account_no VARCHAR(32) NOT NULL COMMENT 'è´¦å·',
    cd_flag CHAR(1) NOT NULL COMMENT 'å€Ÿè´·æ ‡å¿—ï¼šD-å€Ÿæ–¹ï¼ŒC-è´·æ–¹',
    amount DECIMAL(18,2) NOT NULL COMMENT 'å‘ç”Ÿé¢',
    balance DECIMAL(18,2) NOT NULL COMMENT 'ä½™é¢å¿«ç…§',
    voucher_no VARCHAR(32) NOT NULL COMMENT 'ä¼šè®¡å‡­è¯å·',
    biz_no VARCHAR(64) NOT NULL COMMENT 'ä¸šåŠ¡æµæ°´å·',
    biz_type VARCHAR(16) NOT NULL COMMENT 'ä¸šåŠ¡ç±»å‹',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_account_no (account_no),
    INDEX idx_voucher_no (voucher_no),
    INDEX idx_biz_no (biz_no)
) COMMENT='è´¦æˆ·åˆ†æˆ·è´¦è¡¨ï¼ˆå¤å¼è®°è´¦ï¼‰';
```

#### transfer_orderï¼ˆè½¬è´¦è®¢å•è¡¨ï¼‰

```sql
CREATE TABLE transfer_order (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    order_no VARCHAR(32) NOT NULL UNIQUE COMMENT 'è®¢å•å·',
    payer_account_no VARCHAR(32) NOT NULL COMMENT 'ä»˜æ¬¾è´¦å·',
    payee_account_no VARCHAR(32) NOT NULL COMMENT 'æ”¶æ¬¾è´¦å·',
    amount DECIMAL(18,2) NOT NULL COMMENT 'é‡‘é¢',
    currency VARCHAR(3) NOT NULL COMMENT 'å¸ç§',
    status VARCHAR(16) NOT NULL COMMENT 'çŠ¶æ€',
    current_phase VARCHAR(32) COMMENT 'å½“å‰é˜¶æ®µ',
    idempotent_key VARCHAR(64) NOT NULL UNIQUE COMMENT 'å¹‚ç­‰é”®',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_payer (payer_account_no),
    INDEX idx_payee (payee_account_no),
    INDEX idx_status (status)
) COMMENT='è½¬è´¦è®¢å•è¡¨';
```

---

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
mvn test

# è¿è¡ŒæŒ‡å®šæœåŠ¡çš„æµ‹è¯•
cd account-service
mvn test
```

### é›†æˆæµ‹è¯•

```bash
# ä½¿ç”¨ Postman å¯¼å…¥æµ‹è¯•é›†åˆ
docs/postman/MacauBank.postman_collection.json
```

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **è½¬è´¦ TPS** | 1000+ | ä½¿ç”¨ TCC + çŠ¶æ€æœºæ–¹æ¡ˆ |
| **æŸ¥è¯¢ QPS** | 5000+ | Redis ç¼“å­˜åŠ é€Ÿ |
| **å¹³å‡å“åº”æ—¶é—´** | < 100ms | æ­£å¸¸ä¸šåŠ¡åœºæ™¯ |
| **P99 å“åº”æ—¶é—´** | < 500ms | 99% è¯·æ±‚ |
| **æ•°æ®åº“é”æŒæœ‰æ—¶é—´** | < 20ms | ä¹è§‚é”æ–¹æ¡ˆ |

---

## ğŸ“ é¡¹ç›®æ–‡æ¡£

- [æ¶æ„è®¾è®¡æ–‡æ¡£](docs/architecture.md)
- [API æ¥å£æ–‡æ¡£](docs/api.md)
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](docs/database.md)
- [éƒ¨ç½²è¿ç»´æ–‡æ¡£](docs/deployment.md)

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘è§„èŒƒ

1. **ä»£ç è§„èŒƒ**ï¼šéµå¾ªé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œ
2. **æäº¤è§„èŒƒ**ï¼šä½¿ç”¨ Conventional Commits æ ¼å¼
3. **åˆ†æ”¯ç­–ç•¥**ï¼šGit Flow å·¥ä½œæµ
4. **æµ‹è¯•è¦†ç›–ç‡**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ > 80%

---

## ğŸ“„ License

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºåè®®ã€‚

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- [Spring Boot](https://spring.io/projects/spring-boot)
- [Apache Dubbo](https://dubbo.apache.org/)
- [Seata](https://seata.io/)
- [RocketMQ](https://rocketmq.apache.org/)
- [Nacos](https://nacos.io/)
- [SkyWalking](https://skywalking.apache.org/)

---

<div align="center">

**å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ Star æ”¯æŒä¸€ä¸‹ï¼**

Made with â¤ï¸ by MacauBank Team

</div>
